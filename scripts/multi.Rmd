---
title: Antidepressant exposure GWAS multi-ancestry meta-analysis
output:
  html_document:
    df_print: paged
---

```{r lib}
library(dplyr)
library(tidyr)
library(readr)
library(stringr)
library(ggplot2)
library(ggrepel)
library(topr)
library(UpSetR)
library(plyranges)
library(ieugwasr)
library(gwascat)
# Source helper functions 
source("multi_funcs.R")
```

## Principal components

```{r pcs, dpi=218}
plot_ancestry_PCs("antidep-2501-mrmega-N06A.log")
plot_ancestry_PCs("antidep-2501-mrmega-N06AA.log")
plot_ancestry_PCs("antidep-2501-mrmega-N06AB.log")
```

## Manhattan plots


```{r sumstats, cache = TRUE, cache.lazy = FALSE}

mrmega_n06a <- get_sumstats("antidep-2501-mrmega-N06A.gz")
mrmega_n06aa <- get_sumstats("antidep-2501-mrmega-N06AA.gz")
mrmega_n06ab <- get_sumstats("antidep-2501-mrmega-N06AB.gz")

```

```{r assoc}

mrmega_n06a_assoc <- get_assoc(mrmega_n06a)
mrmega_n06aa_assoc <- get_assoc(mrmega_n06aa)
mrmega_n06ab_assoc <- get_assoc(mrmega_n06ab)

```

```{r n06a_multi_manhattan, fig.width=8, fig.height=4.5, dpi=218, cache = TRUE}
plot_manhat(mrmega_n06a_assoc)
plot_manhat(mrmega_n06aa_assoc)
plot_manhat(mrmega_n06ab_assoc)

```

## Clumps

```{r clumps}
clumps_gw_nomhc_gr_N06A <- get_clumps("antidep-2501-mrmega-N06A.clumps")
clumps_gw_nomhc_gr_N06AA <- get_clumps("antidep-2501-mrmega-N06AA.clumps")
clumps_gw_nomhc_gr_N06AB <- get_clumps("antidep-2501-mrmega-N06AB.clumps")
```

## Catalogue

```{r opengwas, eval = FALSE, cache = TRUE}

open_gwas <- phewas(variants = clumps_gw_nomhc_gr |> as_tibble() |> pull(SNP), pval=5e-8)

```

```{r gwascat, cache = TRUE}

gwcat <- get_cached_gwascat()

look_up_snps(clumps_gw_nomhc_gr_N06A, gwcat)
look_up_snps(clumps_gw_nomhc_gr_N06AA, gwcat)
look_up_snps(clumps_gw_nomhc_gr_N06AB, gwcat)

```
