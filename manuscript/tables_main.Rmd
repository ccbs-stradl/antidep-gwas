---
title: Tables for main manuscript
output:
    word_document:
        df_print: kable
---

```{r, setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)
```

```{r counter}
library(dplyr)
library(readr)
library(tidyr)

n <- 0
```

```{r sample_size}
sample_size_table_n <- n <- n + 1
summary_table_fixed <- read_csv(here::here("manuscript/tables/meta_analysis_cohort_summary_table_fixed.csv"))
summary_table_mrmega <- read_csv(here::here("manuscript/tables/meta_analysis_cohort_summary_table_mrmega.csv"))

sample_size_table <-
summary_table_fixed |>
  pivot_longer(cols = !meta_analysis,
               names_to = c("cohort", "status"),
               names_sep = "_",
               values_to = "N") |>
  separate(meta_analysis, into = c("meta", "version", "method", "ATC", "Cluster")) |>
  group_by(ATC, Cluster, status) |>
  summarize(N = sum(N, na.rm = TRUE)) |>
  pivot_wider(names_from = status, values_from = N) |>
  transmute(ATC, Cluster, Cases = cases, Controls = controls, `Neff/2` = round(neff, 2))
```

**Table `r sample_size_table_n`:** Sample sizes for meta-analyses

```{r sample_size_table}
sample_size_table
```